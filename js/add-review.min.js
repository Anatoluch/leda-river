$(document).ready(function(){window.FormData||alert("Браузер не поддерживает загрузку файлов на этом сайте!\nВы не сможете прикрепить аватарку к отзыву!");let e=document.querySelector("#counter"),t=document.querySelector(".counter");$("textarea").keyup(function(){this.value.length>480?(this.value=this.value.substr(0,480),t="color:red; font-weight:700; font-size:16px"):this.value.length<480&&this.value.length>420?t.style="color:orange; font-weight:500; font-size:16px":480==this.value.length?t.style="color:red; font-weight:700; font-size:16px":this.value.length<480&&t.removeAttribute("style")}),$("#counter").html(480),$("#review-Text").keyup(function(){var e=this.value.length;this.value.length>480&&(this.value=this.value.substr(0,480));var t=480-e;t<=0?$("#counter").html("0"):$("#counter").html(t)}),$(".review-avatar").change(function(){""!=$(this).val()?($(this).closest(".file-row").children(".upload-label").text("Файл выбран!"),$(".upload-label").blur(),$(".upload-label").addClass("chosen")):($(this).closest(".file-row").children(".upload-label").text("Выбрать файл"),$(".upload-label").blur(),$(".upload-label").removeClass("chosen"))});let r,i,n,l=document.querySelector(".reviews-page__form"),a=document.querySelectorAll(".reviews-page__form .fake-placeholder"),o=document.querySelector(".review-form-checkbox"),s=document.querySelector("#avatar-preview"),d=document.querySelector("#review-bot-row"),u=document.querySelector("#review-question-1-row"),c=document.querySelector("#review-question-2-row"),h=document.querySelector("#submit-rev-btn"),v=document.querySelector("#reset-rev-btn"),m=document.querySelector("#review-bot-placeholder-1"),p=document.querySelector("#review-bot-placeholder-2"),b=document.querySelector("#review-question-inp-1"),w=document.querySelector("#review-question-inp-2"),f=document.querySelector("#review-bot-question-1"),g=document.querySelector("#review-bot-question-2");o.addEventListener("change",function(e){1==e.target.checked?(r=Math.round(10*Math.random()),i=Math.round(10*Math.random()),n=r+i,b.innerText=`${r} + ${i}?`,d.classList.remove("hidden"),u.classList.remove("hidden"),this.disabled=!0,f.addEventListener("input",function(e){parseInt(e.target.value)===n?(h.disabled=!0,u.classList.add("hidden"),c.classList.remove("hidden"),m.classList.remove("active-field"),f.blur(),g.focus(),o.disabled=!0):h.disabled=!0})):(d.classList.add("hidden"),u.classList.add("hidden"),c.classList.add("hidden"))}),w.innerText="России?",g.addEventListener("input",function(e){"москва"===e.target.value.toLowerCase()?(h.disabled=!1,d.classList.add("hidden"),l.setAttribute("method","POST"),l.setAttribute("action","./php/reviews.php"),c.classList.add("hidden"),p.classList.remove("active-field"),g.blur()):h.disabled=!0}),f.addEventListener("input",function(){this.value=this.value.replace(/[^+0-9]/g,"")}),g.addEventListener("input",function(){this.value=this.value.replace(/[^А-Яа-я-]/g,"")});let q=document.querySelector("#avatar-file");q.addEventListener("input",function(){let e=document.getElementById("avatar-file").files[0],t=new FileReader;return e.size>1048576?(alert("Файл слишком большой! Размер файла не должен превышать 1 МБ!\nПопробуйте выбрать другой файл."),void(q.value="")):"image/jpeg"!==e.type&&"image/png"!==e.type&&"image/gif"!==e.type?(alert("Данный тип файла загрузить нельзя!"),void(q.value="")):(t.onload=function(e){s.innerHTML=`<img src="${e.target.result}" alt="Аватар">`},t.readAsDataURL(e),void(s.style="height:75px;opacity:1;"))}),v.addEventListener("click",function(){o.disabled=!1,h.disabled=!1,a.forEach(function(e){e.classList.remove("active-field")}),d.classList.add("hidden"),u.classList.add("hidden"),c.classList.add("hidden"),t.removeAttribute("style"),e.innerText=480,q.value="",$(".upload-label").text("Выбрать файл"),$(".upload-label").blur(),$(".upload-label").removeClass("chosen"),s.innerHTML="",s.removeAttribute("style"),l.removeAttribute("method","POST"),l.removeAttribute("action","./php/reviews.php"),this.blur(),document.querySelectorAll(".reviews-page__form label.error").forEach(function(e){e.style="display:none"})}),$(".reviews-page__form").validate({rules:{reviewsUserName:{required:!0},reviewsEmail:{required:!0,email:!0},reviewText:{required:!0},reviewsCheckbox:{required:!0},botQuestion1:{required:!0,minlength:1,maxlength:2},botQuestion2:{required:!0,minlength:1,maxlength:6}},messages:{reviewsUserName:{required:"А как к Вам обращаться?!"},reviewsEmail:{required:"Обязательно укажите Ваш email!",email:"Введен некорректный адрес электронной почты!"},review:{required:"А где, собственно, сам отзыв?!"},reviewsCheckbox:{required:"Чтобы добавить отзыв, нужно принять политику конфиденциальности!"},botQuestion1:{required:"Обязательное поле!",minlength:"Ошибка ввода!",maxlength:"Ошибка ввода!"},botQuestion2:{required:"Обязательное поле!",minlength:"Ошибка ввода!",maxlength:"Ошибка ввода!"}},submitHandler:function(e){let t=document.forms.sendForm,r=new FormData(t),i=new XMLHttpRequest;return i.open("POST","php/send.php"),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&($(".reviews-page__form").slideUp(800),$("#review-answer").html("<div class='contact-form__success'>\n\t\t\t<h2>Ваш отзыв принят!<br>\n\t\t\tОн будет&nbsp;опубликован после&nbsp;прохождения модерации!\n\t\t\t</h2>\n\t\t\t</div>"))},i.send(r),!1}})});